{% extends "layouts/hmlr-signed-in.html" %}

{% set serviceName = "Extent annotation tool - map API" %}
{% set pageName = serviceName %}

{% set bodyClasses = "full-width" %}
{% set containerClasses = "full-width" %}

{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/input/macro.njk" import govukInput %}


{% block content %}

<div class="govuk-grid-row">

    <div id="map-controls">

        <h1 class="govuk-heading-l">AV57267</h1>

        <h2 class="govuk-heading-m">
            <span>Extent</span>
            <span id="counter">1 of 14</span>
        </h2>

        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

        <h2 class="govuk-heading-m">Map controls</h2>

        <h3 class="govuk-heading-s">Opacity</h3>

        <div class="govuk-button-group">
            <button id="opacityDown" class="ol-zoom-out" data-module="govuk-button">
            </button>
            &nbsp;
            &nbsp;
            &nbsp;
            <button id="opacityUp" class="ol-zoom-in" data-module="govuk-button">
            </button>
        </div>

        &nbsp;
        &nbsp;
        &nbsp;

        <div class="govuk-form-group">
            <fieldset class="govuk-fieldset">
                <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                    <h3 class="govuk-fieldset__heading">
                        Greyscale
                    </h3>
                </legend>
                <div class="govuk-radios govuk-radios--small govuk-radios--inline" data-module="govuk-radios">
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input" id="greyscaleOff" name="greyscaleControl" type="radio"
                            value="off" checked>
                        <label class="govuk-label govuk-radios__label" for="greyscaleOff">
                            Off
                        </label>
                    </div>
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input" id="greyscaleOn" name="greyscaleControl" type="radio"
                            value="on">
                        <label class="govuk-label govuk-radios__label" for="greyscaleOn">
                            On
                        </label>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>

    <!-- MAP CONTAINER  -->
    <div class="govuk-grid-column-one-half">

        <div>
            <!-- custom zoom controls 
                <div class="zoom-controls">
                    <button id="zoom-in" class="zoom ol-zoom-in zoom-in" type="button" title="Zoom in">+<span
                            class="govuk-visually-hidden">Zoom in</span></button>
                    <button id="zoom-out" class="zoom ol-zoom-out zoom-out" type="button" title="Zoom out">-
                        <span class="govuk-visually-hidden">Zoom out</span>
                    </button>
                </div>

    <!-- MAP  -->
        </div>
        <div id="map" class="annotation-map" tabindex="0" aria-label="Image showing search extent">
        </div>

    </div>

    <!--  NAVIGATION  -->
    <div class="govuk-grid-column-one-third">
        <div>
            <h2 class="govuk-heading-m">Entry ABC123</h2>

            <div class="entry-container">
                {% include "app/includes/entries/AV57267/inc_AV57267-entry-1.html" %}
            </div>

            {% set otherHtml %}
            {{ govukInput({
            id: "other",
            name: "other",
            classes: "govuk-!-width-one-third",
            label: {
            text: "More detail"
            }
            }) }}
            {% endset -%}

            {{ govukRadios({
            classes: "govuk-radios--small",
            name: "defineRelationship",
            fieldset: {
            legend: {
            text: "Does the entry describe the selected extent?",
            classes: "govuk-fieldset__legend--m"
            }
            },
            items: [
            {
            value: "link",
            text: "Yes"
            },
            {
            value: "no-link",
            text: "No"
            },
            {
            value: "other",
            text: "Other",
            conditional: {
            html: otherHtml
            }
            }
            ]
            }) }}
            <div class="govuk-button-group">
                <button id="prevBtn" class="govuk-button govuk-button--secondary" data-module="govuk-button">
                    Previous extent
                </button>
                <br />
                <button id="nextBtn" class="govuk-button govuk-button--primry" data-module="govuk-button">
                    Next extent
                </button>
                <br />
            </div>
            <div style="height:480px;">
            </div>
        </div>
    </div>

</div>

{% endblock %}

{% block pageScripts %}

<!--  Custom map styles for this page -->
<link rel="stylesheet" href="/public/map/css/map-styles.css">

<!-- Jquery -->
<script src="/public/map/jquery.min.js"></script>

<!-- Open Layers -->
<script src="/public/map/ol.js"></script>
<script src="/public/map/proj4.js"></script>
<script src="/public/map/union.js"></script>
<script src="/public/map/draw_hole.js"></script>

<!-- Custom Map Styles -->
<script src="/public/map/hatching_style.js"></script>
<script src="/public/map/map_styles.js"></script>

<!-- Master Map Vector Layer -->
<!--------  NB HACK TO FIX THE MASTER MAP SOURCE  -------->
<script src="/public/map/master_map_vector_layer_fixed.js"></script>
<script src="/public/map/snap_to_vector_layer.js"></script>

<!-- Custom Map Controls -->
<script src="/public/map/map_undo_v1.js"></script>
<script src="/public/map/map_controls.js"></script>
<script src="/public/map/map_helpers_v1.js"></script>

<!-- Map config -->
<script src="/public/map/map_config.js"></script>

<script src="https://cdn.jsdelivr.net/npm/ol@v10.5.0/dist/ol.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.15.0/proj4.js"></script>
<script>

    // Define variables
    const apiKey = 'qZywYzmUQmZLI3uEimKtf1EGxWOHbTSj';
    const parser = new ol.format.WMTSCapabilities();
    let map;
    let vectorLayer;
    let currentOpacity = 1.0;
    let baseMapLayer;


    // Setup the EPSG:27700 (British National Grid) projection.
    proj4.defs("EPSG:27700", "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs");
    ol.proj.proj4.register(proj4);

    fetch('https://api.os.uk/maps/raster/v1/wmts?key=' + apiKey + '&service=WMTS&request=GetCapabilities&version=2.0.0')
        .then(response => response.text())
        .then(text => {
            const result = parser.read(text);
            const options = ol.source.WMTS.optionsFromCapabilities(result, {
                layer: 'Outdoor_27700',
                matrixSet: 'EPSG:27700',
            });

            const source = new ol.source.WMTS(options);
            const layer = new ol.layer.Tile({
                source: source,
                className: '', // Start with no greyscale (default off)
                opacity: 1 // Set base map opacity between 0 and 1
            });

            // Store reference to the base map layer
            baseMapLayer = layer;

            // Create vector source and layer for extents
            vectorSource = new ol.source.Vector();
            vectorLayer = new ol.layer.Vector({
                source: vectorSource,
                style: new ol.style.Style({
                    fill: new ol.style.Fill({
                        color: 'rgba(255, 0, 0, 0.3)'
                    }),
                    stroke: new ol.style.Stroke({
                        color: 'red',
                        width: 2
                    })
                })
            });

            // Initialize the map object.
            map = new ol.Map({
                layers: [layer, vectorLayer],
                target: 'map',
                view: new ol.View({
                    projection: 'EPSG:27700',
                    extent: [-238375.0, 0.0, 900000.0, 1376256.0],
                    resolutions: options.tileGrid.getResolutions(),
                    minZoom: 0,
                    maxZoom: 14,
                    center: [337297, 503695],
                    zoom: 7
                })
            });

            // Initialize map controls
            const opacityUpBtn = document.getElementById('opacityUp');
            const opacityDownBtn = document.getElementById('opacityDown');
            const greyscaleOnRadio = document.getElementById('greyscaleOn');
            const greyscaleOffRadio = document.getElementById('greyscaleOff');

            // Opacity Up button (increase opacity by 0.1)
            opacityUpBtn.addEventListener('click', function () {
                if (currentOpacity < 1.0) {
                    currentOpacity = Math.min(1.0, currentOpacity + 0.1);
                    currentOpacity = Math.round(currentOpacity * 10) / 10; // Round to 1 decimal
                    baseMapLayer.setOpacity(currentOpacity);
                    console.log('Opacity increased to:', currentOpacity);
                }
            });

            // Opacity Down button (decrease opacity by 0.1, minimum 0.1)
            opacityDownBtn.addEventListener('click', function () {
                if (currentOpacity > 0.1) {
                    currentOpacity = Math.max(0.1, currentOpacity - 0.1);
                    currentOpacity = Math.round(currentOpacity * 10) / 10; // Round to 1 decimal
                    baseMapLayer.setOpacity(currentOpacity);
                    console.log('Opacity decreased to:', currentOpacity);
                }
            });

            // Greyscale On radio button
            greyscaleOnRadio.addEventListener('change', function () {
                if (this.checked) {
                    // Find the canvas element and add the greyscale class
                    setTimeout(() => {
                        const canvas = map.getViewport().querySelector('canvas');
                        if (canvas) {
                            canvas.className = 'ol_gs';
                            console.log('Greyscale ON - class added to canvas');
                        }
                    }, 100);
                }
            });

            // Greyscale Off radio button
            greyscaleOffRadio.addEventListener('change', function () {
                if (this.checked) {
                    // Find the canvas element and remove the greyscale class
                    setTimeout(() => {
                        const canvas = map.getViewport().querySelector('canvas');
                        if (canvas) {
                            canvas.className = '';
                            console.log('Greyscale OFF - class removed from canvas');
                        }
                    }, 100);
                }
            });

            // Initialize extent functionality after map is created
            initializeExtentCycling();
        })
        .catch(error => {
            console.error('Error loading map:', error);
        });

    // Initialize the extent counter
    let currentPage = 1;
    const totalPages = 14;
    let count = 0;
    let style_count = 3;
    const counterElement = document.getElementById('counter');
    const nextButton = document.getElementById('nextBtn');
    const prevButton = document.getElementById('prevBtn');

    function initializeExtentCycling() {
        // Update extent counter function
        function updateCounter() {
            counterElement.textContent = currentPage + " of " + totalPages;
        }

        // Next button click handler
        nextButton.addEventListener('click', function () {
            currentPage = (currentPage % totalPages) + 1;
            count++;
            style_count++;
            if (count >= extents.length) {
                count = 0;
            }
            if (style_count > 12) {
                style_count = 0;
            }
            updateCounter();
            showExtent();
        });

        // Previous button click handler
        prevButton.addEventListener('click', function () {
            currentPage = currentPage - 1;
            if (currentPage < 1) {
                currentPage = totalPages;
            }
            count--;
            style_count--;
            if (count < 0) {
                count = extents.length - 1;
            }
            if (style_count < 0) {
                style_count = 12;
            }
            updateCounter();
            showExtent();
        });

        // Initialize with first extent
        console.log('Initializing with first extent');
        showExtent();
    }

    let hoverEventKey = null;
    let hoveredFeature = null;
    let originalStyle = null;

    // Define different style configurations
    const styleConfigurations = [
        {
            // Style 0: Classic red with transparency
            fill: 'rgba(255, 0, 0, 0.3)',
            stroke: '#ff0000',
            strokeWidth: 2,
            name: 'Classic Red'
        },
        {
            // Style 1: Blue with red border (like your image 2)
            fill: 'rgba(0, 100, 200, 0.4)',
            stroke: '#cc0000',
            strokeWidth: 3,
            name: 'Blue Fill Red Border'
        },
        {
            // Style 2: Green with diagonal hatching
            fill: 'rgba(0, 150, 0, 0.15)',
            stroke: '#006600',
            strokeWidth: 2,
            pattern: 'diagonal',
            patternColor: '#006600',
            name: 'Green Diagonal Hatch'
        },
        {
            // Style 3: Purple with solid fill
            fill: 'rgba(128, 0, 128, 0.5)',
            stroke: '#800080',
            strokeWidth: 2,
            name: 'Purple Solid'
        },
        {
            // Style 4: Orange with cross-hatch
            fill: 'rgba(255, 165, 0, 0.15)',
            stroke: '#ff6600',
            strokeWidth: 2,
            pattern: 'crosshatch',
            patternColor: '#ff6600',
            name: 'Orange Cross-hatch'
        },
        {
            // Style 5: Pink with dots pattern
            fill: 'rgba(255, 192, 203, 0.2)',
            stroke: '#ff1493',
            strokeWidth: 2,
            pattern: 'dots',
            patternColor: '#ff1493',
            name: 'Pink Dots'
        },
        {
            // Style 6: Teal with vertical lines
            fill: 'rgba(0, 128, 128, 0.15)',
            stroke: '#008080',
            strokeWidth: 2,
            pattern: 'vertical',
            patternColor: '#008080',
            name: 'Teal Vertical'
        },
        {
            // Style 7: Navy with horizontal lines
            fill: 'rgba(0, 0, 128, 0.2)',
            stroke: '#000080',
            strokeWidth: 3,
            pattern: 'horizontal',
            patternColor: '#000080',
            name: 'Navy Horizontal'
        },
        {
            // Style 8: Yellow with black border
            fill: 'rgba(255, 255, 0, 0.4)',
            stroke: '#000000',
            strokeWidth: 2,
            name: 'Yellow Black Border'
        },
        {
            // Style 9: Cyan with reverse diagonal hatching
            fill: 'rgba(0, 255, 255, 0.15)',
            stroke: '#ff00ff',
            strokeWidth: 2,
            pattern: 'diagonal_reverse',
            patternColor: '#00aaaa',
            name: 'Cyan Reverse Diagonal'
        },
        {
            // Style 10: Light green with dark green thick border
            fill: 'rgba(144, 238, 144, 0.6)',
            stroke: '#228b22',
            strokeWidth: 4,
            name: 'Light Green Thick Border'
        },
        {
            // Style 11: Brown with grid pattern
            fill: 'rgba(139, 69, 19, 0.15)',
            stroke: '#8b4513',
            strokeWidth: 2,
            pattern: 'grid',
            patternColor: '#8b4513',
            name: 'Brown Grid'
        },
        {
            // Style 12: Indigo with dense diagonal hatching
            fill: 'rgba(75, 0, 130, 0.15)',
            stroke: '#4b0082',
            strokeWidth: 2,
            pattern: 'dense_diagonal',
            patternColor: '#4b0082',
            name: 'Indigo Dense Hatch'
        }
    ];

    // Function to create hatching pattern as canvas pattern for OpenLayers
    function createHatchingPattern(patternType, color, backgroundColor) {
        const canvas = document.createElement('canvas');
        const size = 20;
        canvas.width = size;
        canvas.height = size;
        const ctx = canvas.getContext('2d');

        // Fill with background color (semi-transparent)
        ctx.fillStyle = backgroundColor;
        ctx.fillRect(0, 0, size, size);

        // Draw pattern
        ctx.strokeStyle = color;
        ctx.lineWidth = 1;
        ctx.beginPath();

        switch (patternType) {
            case 'diagonal':
                // Diagonal lines from bottom-left to top-right
                for (let i = -size; i <= size * 2; i += 6) {
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i + size, size);
                }
                break;

            case 'diagonal_reverse':
                // Diagonal lines from top-left to bottom-right
                for (let i = -size; i <= size * 2; i += 6) {
                    ctx.moveTo(i, size);
                    ctx.lineTo(i + size, 0);
                }
                break;

            case 'crosshatch':
                // Both diagonal directions
                for (let i = -size; i <= size * 2; i += 8) {
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i + size, size);
                    ctx.moveTo(i, size);
                    ctx.lineTo(i + size, 0);
                }
                break;

            case 'vertical':
                // Vertical lines
                for (let i = 0; i < size; i += 5) {
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, size);
                }
                break;

            case 'horizontal':
                // Horizontal lines
                for (let i = 0; i < size; i += 5) {
                    ctx.moveTo(0, i);
                    ctx.lineTo(size, i);
                }
                break;

            case 'grid':
                // Grid pattern
                for (let i = 0; i < size; i += 6) {
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, size);
                    ctx.moveTo(0, i);
                    ctx.lineTo(size, i);
                }
                break;

            case 'dense_diagonal':
                // Dense diagonal hatching
                for (let i = -size; i <= size * 2; i += 4) {
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i + size, size);
                }
                break;

            case 'dots':
                ctx.stroke(); // Clear any pending paths
                ctx.fillStyle = color;
                for (let x = 3; x < size; x += 6) {
                    for (let y = 3; y < size; y += 6) {
                        ctx.beginPath();
                        ctx.arc(x, y, 1.5, 0, 2 * Math.PI);
                        ctx.fill();
                    }
                }
                return canvas; // Return early for dots
        }

        ctx.stroke();
        return canvas;
    }

    // Function to create style with optional pattern
    function createStyleWithPattern(styleConfig) {
        let fillStyle;

        if (styleConfig.pattern) {
            // Create pattern using canvas
            const patternCanvas = createHatchingPattern(
                styleConfig.pattern,
                styleConfig.patternColor || styleConfig.stroke,
                styleConfig.fill
            );

            // Create pattern context for OpenLayers
            const patternCtx = document.createElement('canvas').getContext('2d');
            const pattern = patternCtx.createPattern(patternCanvas, 'repeat');

            // For OpenLayers, we need to use a custom renderer approach
            // We'll create a style function that draws the pattern
            return function (feature, resolution) {
                return new ol.style.Style({
                    fill: new ol.style.Fill({
                        color: function (context) {
                            const canvas = context.canvas;
                            const ctx = canvas.getContext('2d');
                            const pattern = ctx.createPattern(patternCanvas, 'repeat');
                            return pattern;
                        }
                    }),
                    stroke: new ol.style.Stroke({
                        color: styleConfig.stroke,
                        width: styleConfig.strokeWidth
                    })
                });
            };
        } else {
            // Simple solid fill
            return new ol.style.Style({
                fill: new ol.style.Fill({
                    color: styleConfig.fill
                }),
                stroke: new ol.style.Stroke({
                    color: styleConfig.stroke,
                    width: styleConfig.strokeWidth
                })
            });
        }
    }

    // Create a custom style function for patterns that works with OpenLayers
    function createPatternStyleFunction(styleConfig) {
        if (!styleConfig.pattern) {
            return new ol.style.Style({
                fill: new ol.style.Fill({
                    color: styleConfig.fill
                }),
                stroke: new ol.style.Stroke({
                    color: styleConfig.stroke,
                    width: styleConfig.strokeWidth
                })
            });
        }

        // For patterns, create a style function
        return function (feature, resolution) {
            const patternCanvas = createHatchingPattern(
                styleConfig.pattern,
                styleConfig.patternColor || styleConfig.stroke,
                styleConfig.fill
            );

            return new ol.style.Style({
                fill: new ol.style.Fill({
                    color: function (pixelContext) {
                        const context = pixelContext.context;
                        const pattern = context.createPattern(patternCanvas, 'repeat');
                        return pattern || styleConfig.fill;
                    }
                }),
                stroke: new ol.style.Stroke({
                    color: styleConfig.stroke,
                    width: styleConfig.strokeWidth
                }),
                // Custom renderer for the pattern
                renderer: function (coordinates, state) {
                    const context = state.context;
                    const pixelRatio = state.pixelRatio;

                    // Save the current context
                    context.save();

                    // Create the pattern
                    const pattern = context.createPattern(patternCanvas, 'repeat');

                    // Draw the geometry with pattern
                    context.beginPath();

                    // Handle different geometry types
                    if (coordinates[0] && Array.isArray(coordinates[0][0])) {
                        // Polygon
                        coordinates.forEach((ring) => {
                            ring.forEach((coord, index) => {
                                if (index === 0) {
                                    context.moveTo(coord[0], coord[1]);
                                } else {
                                    context.lineTo(coord[0], coord[1]);
                                }
                            });
                            context.closePath();
                        });
                    }

                    // Fill with pattern
                    if (pattern) {
                        context.fillStyle = pattern;
                        context.fill();
                    }

                    // Stroke the outline
                    context.strokeStyle = styleConfig.stroke;
                    context.lineWidth = styleConfig.strokeWidth;
                    context.stroke();

                    // Restore context
                    context.restore();
                }
            });
        };
    }

    // Extents function with patterns and hover style
    function showExtent() {
        console.log('showExtent called, count:', count, 'extent:', extents[count], 'style_count:', style_count);

        if (!vectorSource || !extents[count]) {
            console.log('vectorSource or extent not available');
            return;
        }

        // Hover event listener
        if (hoverEventKey) {
            ol.Observable.unByKey(hoverEventKey);
            hoverEventKey = null;
        }

        // Reset hover state
        if (hoveredFeature) {
            hoveredFeature.setStyle(originalStyle);
            hoveredFeature = null;
            originalStyle = null;
        }

        // Get current style configuration
        const currentStyleConfig = styleConfigurations[style_count % styleConfigurations.length];
        console.log('Using style:', currentStyleConfig.name, 'Index:', style_count % styleConfigurations.length);

        // Create default style with current configuration
        const defaultStyle = createPatternStyleFunction(currentStyleConfig);

        // Create extent hover style 
        const hoverStyle = new ol.style.Style({
            fill: new ol.style.Fill({
                color: 'rgba(0, 48, 120, 0.8)' // GOVUK Link Hover Blue fill
            }),
            stroke: new ol.style.Stroke({
                color: '#ffdd00', // GOVUK Focus Yellow border
                width: 2
            })
        });

        // Clear existing features
        vectorSource.clear();

        try {
            // Load the current extent
            const extent = extents[count];
            const geojsonFormat = new ol.format.GeoJSON();

            // Read features with explicit projection conversion
            const features = geojsonFormat.readFeatures(extent, {
                dataProjection: 'EPSG:27700',
                featureProjection: 'EPSG:27700'
            });

            console.log('Features loaded:', features.length);

            if (features.length > 0) {
                // Set default style for all features
                features.forEach(feature => {
                    feature.setStyle(defaultStyle);
                });

                vectorSource.addFeatures(features);

                // Add hover event listener with your original colors
                hoverEventKey = map.on('pointermove', function (evt) {
                    const pixel = map.getEventPixel(evt.originalEvent);
                    const feature = map.forEachFeatureAtPixel(pixel, function (feature) {
                        return feature;
                    });

                    if (feature && feature !== hoveredFeature) {
                        // Restore previous hovered feature's style
                        if (hoveredFeature) {
                            hoveredFeature.setStyle(defaultStyle);
                        }

                        // Apply hover style to new feature (blue and yellow)
                        hoveredFeature = feature;
                        originalStyle = feature.getStyle();
                        feature.setStyle(hoverStyle);
                    } else if (!feature && hoveredFeature) {
                        // No feature under cursor, restore default style
                        hoveredFeature.setStyle(defaultStyle);
                        hoveredFeature = null;
                        originalStyle = null;
                    }
                });

                // Fit the view to the extent with padding
                const geometry = features[0].getGeometry();
                const extentBounds = geometry.getExtent();
                console.log('Extent bounds:', extentBounds);

                map.getView().fit(extentBounds, {
                    padding: [50, 50, 50, 50]
                });
            }
        } catch (error) {
            console.error('Error loading extent:', error);
        }
    }


    // Extents GeoJSON coordinates
    let extents = [
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532042.65, 181758.8], [532046.85, 181752.4], [532047.15, 181751.9], [532047.5, 181751.45], [532048.3, 181750.1], [532051.95, 181752.55], [532052.25, 181752.75], [532051.5, 181754.0], [532050.8, 181755.0], [532046.45, 181761.45], [532042.65, 181758.8]
                            ]
                        ],
                        "type": "Polygon",
                    },
                    "properties": { "id": 1000 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532032.2, 181739.4], [532036.2, 181734.35], [532042.7, 181739.1], [532046.3, 181741.7], [532048.35, 181743.2], [532053.1, 181736.4], [532060.45, 181740.65], [532051.95, 181752.55], [532048.3, 181750.1], [532047.5, 181751.45], [532046.85, 181752.4], [532042.65, 181758.8], [532036.3, 181754.65], [532040.7, 181747.9], [532032.7, 181742.95], [532034.1, 181740.7], [532032.2, 181739.4]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1001 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532032.7, 181742.95], [532034.1, 181740.7], [532038.9, 181743.9], [532042, 181745.9], [532042.5, 181746.25], [532043.55, 181746.95], [532045.05, 181747.95], [532048.3, 181750.1], [532051.95, 181752.55], [532052.25, 181752.75], [532051.5, 181754], [532050.8, 181755], [532046.85, 181752.4], [532042.65, 181758.8], [532036.3, 181754.65], [532040.7, 181747.9], [532032.7, 181742.95]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1002 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532017.1, 181740.25], [532023.3, 181733.7], [532023.9, 181734.05], [532028.75, 181737.2], [532031.05, 181738.65], [532032.2, 181739.4], [532034.1, 181740.7], [532038.9, 181743.9], [532042, 181745.9], [532042.5, 181746.25], [532043.55, 181746.95], [532045.05, 181747.95], [532048.3, 181750.1], [532047.5, 181751.45], [532046.85, 181752.4], [532042.65, 181758.8], [532036.3, 181754.65], [532029.7, 181750.4], [532017.45, 181742.55], [532017.1, 181740.25]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1003 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532096.659508772, 181839.07500000004], [531978.2764912281, 181784.47500000006], [531943.9524210526, 181764.17500000005], [531860.5939649123, 181713.77500000005], [531894.2175438596, 181676.67500000005], [531915.9327719299, 181654.97500000006], [531945.3534035088, 181629.77500000005], [532033.6152982457, 181535.97500000006], [532068.6398596491, 181568.17500000005], [532116.2732631579, 181582.17500000005], [532137.2880000001, 181614.37500000006], [532096.659508772, 181839.07500000004]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1004 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532042.65, 181758.8], [532046.85, 181752.4], [532047.15, 181751.9], [532047.5, 181751.45], [532048.3, 181750.1], [532051.95, 181752.55], [532052.25, 181752.75], [532051.5, 181754.0], [532050.8, 181755.0], [532046.45, 181761.45], [532042.65, 181758.8]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1005 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532096.659508772, 181839.07500000004], [531978.2764912281, 181784.47500000006], [531943.9524210526, 181764.17500000005], [531860.5939649123, 181713.77500000005], [531894.2175438596, 181676.67500000005], [531915.9327719299, 181654.97500000006], [531945.3534035088, 181629.77500000005], [532033.6152982457, 181535.97500000006], [532068.6398596491, 181568.17500000005], [532116.2732631579, 181582.17500000005], [532137.2880000001, 181614.37500000006], [532096.659508772, 181839.07500000004]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1006 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532017.1, 181740.25], [532023.3, 181733.7], [532023.9, 181734.05], [532030.55, 181725.8], [532035.3, 181729.15], [532038.55, 181731.4], [532036.2, 181734.35], [532042.7, 181739.1], [532046.3, 181741.7], [532048.35, 181743.2], [532053.1, 181736.4], [532060.45, 181740.65], [532061.9, 181737.85], [532063.75, 181739.25], [532064.6, 181737.6], [532065.5, 181738], [532069.1, 181739.8], [532073.95, 181742.25], [532076.5, 181736.6], [532076.9, 181736.85], [532077.35, 181737.1], [532077.5, 181736.8], [532079.3, 181737.45], [532078.65, 181742], [532082.2, 181742.5], [532080.5, 181753.8], [532073.85, 181752.8], [532073.15, 181756.8], [532073.05, 181758.75], [532072.85, 181759.45], [532069.7, 181764.5], [532072.6, 181766.15], [532067.8, 181776.05], [532058.3, 181769.8], [532046.45, 181761.45], [532042.65, 181758.8], [532036.3, 181754.65], [532029.7, 181750.4], [532017.45, 181742.55], [532017.1, 181740.25]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1007 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532042.5, 181746.25], [532042, 181745.9], [532040.7, 181747.9], [532036.3, 181754.65], [532042.65, 181758.8], [532046.85, 181752.4], [532047.5, 181751.45], [532048.3, 181750.1], [532045.05, 181747.95], [532043.55, 181746.95], [532042.5, 181746.25]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1008 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532062.65, 181763.15], [532064.1, 181760.85], [532062.15, 181759.5], [532059.45, 181757.65], [532052.25, 181752.75], [532051.5, 181754], [532050.8, 181755], [532046.45, 181761.45], [532058.3, 181769.8], [532062.65, 181763.15]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1009 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532058.3, 181769.8], [532062.65, 181763.15], [532064.1, 181760.85], [532069.7, 181764.5], [532072.6, 181766.15], [532067.8, 181776.05], [532058.3, 181769.8]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1010 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532017.1, 181740.25], [532023.3, 181733.7], [532023.9, 181734.05], [532030.55, 181725.8], [532035.3, 181729.15], [532038.55, 181731.4], [532036.2, 181734.35], [532042.7, 181739.1], [532046.3, 181741.7], [532048.35, 181743.2], [532053.1, 181736.4], [532060.45, 181740.65], [532061.9, 181737.85], [532063.75, 181739.25], [532064.6, 181737.6], [532065.5, 181738], [532069.1, 181739.8], [532073.95, 181742.25], [532076.5, 181736.6], [532076.9, 181736.85], [532077.35, 181737.1], [532077.5, 181736.8], [532079.3, 181737.45], [532078.65, 181742], [532082.2, 181742.5], [532080.5, 181753.8], [532073.85, 181752.8], [532073.15, 181756.8], [532073.05, 181758.75], [532072.85, 181759.45], [532069.7, 181764.5], [532072.6, 181766.15], [532067.8, 181776.05], [532058.3, 181769.8], [532046.45, 181761.45], [532042.65, 181758.8], [532036.3, 181754.65], [532029.7, 181750.4], [532017.45, 181742.55], [532017.1, 181740.25]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1011 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532062.65, 181763.15], [532064.1, 181760.85], [532062.15, 181759.5], [532059.45, 181757.65], [532052.25, 181752.75], [532051.5, 181754], [532050.8, 181755], [532046.45, 181761.45], [532058.3, 181769.8], [532062.65, 181763.15]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1012 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        },
        {
            "features": [
                {
                    "geometry":
                    {
                        "coordinates": [
                            [
                                [532051.95, 181792.9], [532059.05, 181791.5], [532065.3, 181781.4], [532054.6, 181774.3], [532046.3, 181768.85], [532042, 181775.2], [532040.85, 181775.5], [532036.35, 181782.95], [532044.8, 181788.4], [532051.95, 181792.9]
                            ]
                        ],
                        "type": "Polygon"
                    },
                    "properties": { "id": 1013 },
                    "type": "Feature"
                }],
            "type": "FeatureCollection"
        }

    ]


</script>

{% endblock %}